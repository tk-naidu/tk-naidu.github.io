<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700" rel="stylesheet">

 <title>Search</title>
<!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Additional CSS Files -->
    <link rel="stylesheet" href="assets/css/fontawesome.css">
    <link rel="stylesheet" href="assets/css/templatemo-style.css">
    <link rel="stylesheet" href="assets/css/owl.css">

<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/6.0.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/6.0.2/firebase-firestore.js"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
</head>

<body class="is-preload">

  <!-- Wrapper -->
    <div id="wrapper">

      <!-- Main -->
        <div id="main">
          <div class="inner">

            <!-- Header -->
            <header id="header">
              <div class="logo">
                <a href="home.html">User Portal</a>
              </div>
            </header>
			<!-- Page Heading -->
            <div class="page-heading">
              <div class="container-fluid">
                <div class="row">
                  <div class="col-md-12">
                    <br>
                    <h2>Display reviews</h2>
                  </div>
                </div>
              </div>
            </div>
            

            <!-- =========================================================================================== -->
            <div class="row">
                <div class="col-md-6">
                    <fieldset>
                      <label>Search Review value: </label>
                      <input name="search" type="text" class="form-control" id="plumber" placeholder="Value..." required>
                      <button type="button" onclick = searchReview()>Search</button>
                      <!-- <button type="button" onclick = clear()>clear</button> -->
                      <a href="viewReviews.html">clear</a>

                    </fieldset>
           		</div>
           	</div>

           	<!-- Tables -->
            <section class="tables">
              <div class="container-fluid">
                <div class="row">
                  <div class="col-md-12">
                    <div class="section-heading">
                      <h2>Tables</h2>
                    </div>
                    <div class="default-table">
                      <table id="itemList">
                        <thead>
                          <tr>
                            <th>CaseID</th>
                            <th>FeedBack</th>
                            <th>Rating</th>
                          </tr>
                        </thead>
                        <tbody>
                          
                        </tbody>
                      </table>

                      <p id=average></p>
         </div>
	</div>
</div>
</div>
</section>
<section class="contact-form">
              <div class="container-fluid">
                <div class="row">
                  <div class="col-md-12">
                   <footer>
                    <p>Created by: Team highTech</p>
                    <p> Copyright &copy; 2019 COS 301 HighTech</p>
                    <p>Contact information: <a href="tuksHightech1@gmail.com">tuksHightech@gmail</a>.</p>
                  </footer>
                </div>
              </div>
            </div>
        </section>
<!-- Sidebar -->
        <div id="sidebar">

          <div class="inner">

            
              
            <!-- Menu -->
            <nav id="menu">
              <ul>
                <li><a href="home2.html">Homepage</a></li>
            
                <li>
                  <span class="opener">Reviews</span>
                  <ul>
                    <li><a href="review.html">Submit Review</a></li>
                    <li><a href="viewReviews.html">View Reviews</a></li>
                
                  </ul>
                </li>
                
                <li><a href="https://www.google.com">External Link</a></li>
                <li><a href="index.html">Logout</a></li>
              </ul>
            </nav>

            

            <!-- Footer -->
            <footer id="footer">
              <p class="copyright">Copyright &copy; 2019 COS 301 HighTech
              <br>Designed by <a rel="nofollow" href="https://www.facebook.com/templatemo">Template Mo</a></p>
            </footer>
            
          </div>
        </div>

    </div>




<script >
  var identifier="abcdefghij";
	var firebaseConfig = {
    apiKey: "AIzaSyDibg-oYRpVXU9HqCAOLdxIpYXcZUPpAGM",
    authDomain: "geyser-74ddf.firebaseapp.com",
    databaseURL: "https://geyser-74ddf.firebaseio.com",
    projectId: "geyser-74ddf",
    storageBucket: "geyser-74ddf.appspot.com",
    messagingSenderId: "1001903322970",
    appId: "1:1001903322970:web:a904b91e99d67b22"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  var database = firebase.firestore();

 



	function searchReview() {
// clear();
var rating=document.getElementById("plumber").value;
console.log(rating);
const display=document.querySelector("#display");
var c=0;
if(rating!="all"){
database.collection("feedback").get().then(function(querySnapshot)
{

  querySnapshot.forEach(function(doc){
  	console.log(doc.data());
    if(rating==doc.data().rating){
	     
	    console.log("entry foound"
	      
	      //can add.details to be specific
	      );
	    var rows = "";
	    //rows += "<tr><td>" +...++"</td></tr>";
	    rows= "<tr><td>"+doc.data().caseNumber+"</td><td>"+doc.data().feedback
	    +"</td><td>"+doc.data().rating+"</td></tr>";
	    $( rows ).appendTo( "#itemList tbody" );
	  }
	}
  );

  
});

}
else
{
   var count =0;
  var sum = 0;
  var total = 0;
  database.collection("feedback").get().then(function(querySnapshot)
{

  querySnapshot.forEach(function(doc){
    console.log(doc.data());
    count++;
      sum = sum+doc.data().rating;
      var rows = "";
      //rows += "<tr><td>" +...++"</td></tr>";
      rows= "<tr><td>"+doc.data().caseNumber+"</td><td>"+doc.data().feedback
      +"</td><td>"+doc.data().rating+"</td></tr>";
      $( rows ).appendTo( "#itemList tbody" );
    
  }
  );
  total = sum/count;
    console.log(total.toFixed(0));
document.getElementById("average").innerHTML="Average: " + total;
  
});
}
}





</script>

<!-- Scripts -->
  <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <script src="assets/js/browser.min.js"></script>
    <script src="assets/js/breakpoints.min.js"></script>
    <script src="assets/js/transition.js"></script>
    <script src="assets/js/owl-carousel.js"></script>
    <script src="assets/js/custom.js"></script>
    <script>
    	function clear(){
	//$("#itemList tr").remove();
	var elmtTable = document.getElementById('itemList');
var tableRows = elmtTable.getElementsByTagName('tr');
var rowCount = tableRows.length;

for (var x=rowCount-1; x>0; x--) {
   elmtTable.removeChild(tableRows[x]);
}
location.reload();
}
</script>
	

  


			
</body>
</html>